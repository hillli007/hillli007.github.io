<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">
































<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="LXL Notes">
<meta property="og:url" content="https://hillli007.github.io/page/5/index.html">
<meta property="og:site_name" content="LXL Notes">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LXL Notes">






  <link rel="canonical" href="https://hillli007.github.io/page/5/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>LXL Notes</title>
  












  <noscript>
  <style>
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion .logo-line-before i { left: initial; }
    .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">LXL Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Keep some mementos</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hillli007.github.io/2018/10/15/android-framework/android-pm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Li Xiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LXL Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/15/android-framework/android-pm/" class="post-title-link" itemprop="https://hillli007.github.io/page/5/index.html">Android包管理与权限机制</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-15 00:05:17" itemprop="dateCreated datePublished" datetime="2018-10-15T00:05:17+08:00">2018-10-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 23:18:34" itemprop="dateModified" datetime="2019-08-22T23:18:34+08:00">2019-08-22</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Android框架/" itemprop="url" rel="index"><span itemprop="name">Android框架</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3><ul>
<li>aapt打包资源文件(res/ assets/ AndroidManifest.xml)，生成resources.ap_ 和R.java文件</li>
<li>处理AIDL文件，生成对应的.java文件</li>
<li>javac 编译Java文件，生成对应的.class文件</li>
<li>把.class文件转化成Davik VM支持的.dex文件</li>
<li>apkbuilder：打包生成未签名的.apk文件</li>
<li>jarsigner：对未签名.apk文件进行签名</li>
<li>zipalign：对签名后的.apk文件进行对齐处理</li>
</ul>
<h3 id="混淆"><a href="#混淆" class="headerlink" title="混淆"></a>混淆</h3><ul>
<li><p>混淆器(Proguard)通过删除从未用过的代码和使用晦涩名字重命名类、字段和方法，对代码进行压缩，优化和混淆。Proguard被集成在android 构建系统中。</p>
</li>
<li><p>不是所有Java代码都可以混淆，比如需要加入了so文件，需要调用里面的方法，那么调用JNI访问so文件的方法就不能被混码。在导出的时候，可能不会报错。但是在手机上运行的时候，需要调用so文件的时候，就会报某某方法无法找到。这个时候就需要用到配置文件proguard-project.txt，配置文件可另外指定。</p>
</li>
</ul>
<p>配置文件例子：</p>
<p>所有View的子类及其子类的get、set方法都不进行混淆</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-keepclassmembers public class * extends android.view.View &#123;        void set*(***);       *** get*();&#125;</span><br></pre></td></tr></table></figure>
<h3 id="UID和GID"><a href="#UID和GID" class="headerlink" title="UID和GID"></a>UID和GID</h3><ul>
<li>每个程序在安装时都会指定一个Linux用户ID（UID），并且在设备中保持它的持久性</li>
<li>安卓中应用程序用户ID(UID)等于用户组ID(GID)</li>
<li>可以在AndroidManifest文件的manifest标签属性sharedUserId指定用户ID</li>
<li>应用可分配相同的用户ID，但必须有相同签名</li>
<li>拥有同一个UID的多个APK可以配置成运行在同一个进程中，所以默认就是可以互相访问任意数据</li>
<li>拥有同一个UID的多个APK也可以配置成运行成不同的进程, 可以访问其他APK的数据目录下的数据库和文件，就像访问本程序的数据一样</li>
</ul>
<h3 id="GIDS"><a href="#GIDS" class="headerlink" title="GIDS"></a>GIDS</h3><ul>
<li>GIDS是由框架在APK安装过程中生成，与APK申请的具体权限相关</li>
<li>如果 APK 申请的相应的 permission 被 granted ，而且权限有对应的gids，那么这个APK的GIDS中将包含这个权限的GIDS</li>
<li>一个GIDS相当于一个权限的集合一个UID可以关联GIDS，表明该UID拥有多种权限</li>
</ul>
<h3 id="系统应用和特权应用"><a href="#系统应用和特权应用" class="headerlink" title="系统应用和特权应用"></a>系统应用和特权应用</h3><p>特权app首先是System app，然后要具有ApplicationInfo.PRIVATE_FLAG_PRIVILEGED标志</p>
<p>特定的shared uid的app是特权应用，同时也是系统应用</p>
<ul>
<li>android.uid.system</li>
<li>android.uid.phone</li>
<li>android.uid.log</li>
<li>android.uid.nfc</li>
<li>android.uid.bluetooth</li>
<li>android.uid.shell</li>
</ul>
<p>特定目录中的app:</p>
<ul>
<li>/vendor/overlay</li>
<li>/system/framework</li>
<li>/system/priv-app</li>
<li>/system/app</li>
<li>/vendor/app</li>
<li>/oem/app</li>
</ul>
<p>特定目录中的app</p>
<ul>
<li>/system/priv-app</li>
<li>/system/framework(该目录中的apk，只是包含资源，不包含代码）</li>
</ul>
<h3 id="签名"><a href="#签名" class="headerlink" title="签名"></a>签名</h3><ol>
<li>APK必须签名才能安装，必须签名相同才能覆盖升级</li>
<li>具有相同签名的程序可运行在同一个进程</li>
<li>Android权限机制在某个权限(permission)的protectionLevel是signature时，允许同签名程序共享数据和功能</li>
</ol>
<h2 id="Permission创建"><a href="#Permission创建" class="headerlink" title="Permission创建"></a>Permission创建</h2><h3 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h3><p>从AndroidManifest.xml中提取permission信息</p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>获取Package中的证书，验证，并将签名信息保存在Package结构中</p>
<p>如果该package来自 system img （系统app），那么只需要从该 Package 的AndroidManifest.xml 中获取签名信息，而无需验证其完整性。但是如果这个 package 与其它 package 共享一个 uid ，那么这个共享 uid 对应的 sharedUser 中保存的签名与之不一致，那么签名验证失败。</p>
<p>如果是普通的 package ，那么需要提取证书和签名信息，并对文件的完成性进行验证</p>
<h3 id="清除领养"><a href="#清除领养" class="headerlink" title="清除领养"></a>清除领养</h3><p>如果是普通的package，那么清除package的mAdoptPermissions字段信息，系统 package 升级才使用</p>
<h3 id="分配uid"><a href="#分配uid" class="headerlink" title="分配uid"></a>分配uid</h3><p>如果在 AndroidManifest.xml 中指定了 shared user ，那么先查看全局 list 中（ mSharedUsers ）是否该 uid 对应的 SharedUserSetting 数据结构，若没有则新分配一个 uid ，创建 SharedUserSetting 并保存到全局全局 list （ mSharedUsers ）中。</p>
<p>mUserIds 保存了系统中已经分配的 uid 对应的 SharedUserSetting 结构。每次分配时总是从第一个开始轮询，找到第一个空闲的位置 i ，然后加上 FIRST_APPLICATION_UID 即可。</p>
<h3 id="维护数据结构"><a href="#维护数据结构" class="headerlink" title="维护数据结构"></a>维护数据结构</h3><p>创建 PackageSettings 数据结构。并将 PackageSettings 与 SharedUserSetting 进行绑定</p>
<p>其中 PackageSettings 保存了 SharedUserSetting 结构；而 SharedUserSetting 中会使用 PackageSettings 中的签名信息填充自己内部的签名信息，并将 PackageSettings 添加到一个队列中，表示 PackageSettings 为其中的共享者之一。<br>在创建时，首先会以 packageName 去全局数据结构 mPackages 中查询是否已经有对应的 PackageSettings 数据结构存在。如果已经存在 PackageSettings 数据结构（比如这个 package 已经被 uninstall ，但是还没有删除数据，此时 package 结构已经被释放）。那么比较该 package 中的签名信息（从 AndroidManifest 中扫描得到）与 PackageSettings 中的签名信息是否匹配。如果不匹配但是为 system package ，那么信任此 package ，并将 package 中的签名信息更新到已有的 PackageSettings 中去，同时如果这个 package 与其它 package 共享了 uid ，而且 shared uid 中保存的签名信息与当前 package 不符，那么签名也验证失败。</p>
<h3 id="权限领养"><a href="#权限领养" class="headerlink" title="权限领养"></a>权限领养</h3><p>如果 mAdoptPermissions 字段不为空，那么处理 permission 的领养，从指定的 package 对应的 PackageSettings 中，将权限的拥有者修改为当前 package ，一般在 system app 升级的时候才发生，在此之前需要验证当被领养的 package 已经被卸载，即检查 package 数据结构是否存在</p>
<h3 id="添加自定义权限"><a href="#添加自定义权限" class="headerlink" title="添加自定义权限"></a>添加自定义权限</h3><p>将 package 中定义的 permissionGroup 添加到全局的列表 mPermissionGroups 中去；<br>将 package 中定义的 permissions 添加到全局的列表中去<br>如果是 permission-tree添加到 mSettings.mPermissionTrees<br>如果是permission 添加到 mSettings.mPermissions</p>
<h3 id="清除不一致的-permission-信息"><a href="#清除不一致的-permission-信息" class="headerlink" title="清除不一致的 permission 信息"></a>清除不一致的 permission 信息</h3><p>清除不一致的 permission-tree 信息。如果该 permission-tree 的 packageSettings 字段为空，说明还未对该 package 进行过解析（若代码执行到此处时 packageSettings 肯定已经被创建过），将其 remove 掉。如果 packageSettings 不为空，但是对应的 package 数据结构为空（说明该 package 已经被卸载，但数据还有保留），或者 package 数据结构中根本不含有这个 permission-tree ，那么将这个 permission-tree 清除<br>清除不一致的 permission 信息。如果 packageSettings 或者 package 结构为空（未解析该 package 或者被卸载，但数据有保留），或者 package 中根本没有定义该 permission ，那么将该 permission 清除</p>
<h3 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h3><p>对每一个 package 进行轮询，并进行 permission授权</p>
<p>对申请的权限进行检查，并更新 grantedPermissions 列表<br>如果其没有设置 shared user id ，那么将其 gids 初始化为 mGlobalGids ，它从 permission.xml 中读取</p>
<p>遍历所有申请的权限，进行如下检查：</p>
<p>如果是该权限是 normal 或者 dangerous的。通过检查。<br>如果权限需要签名验证。如果签名验证通过。还需要进行如下检查<br>如果程序升级，而且是 system package 。那么是否授予该权限要看原来的 package 是否被授予了该权限。如果被授予了，那么通过检查，否则不通过。<br>如果是新安装的。那么检查通过。</p>
<p>如果检查通过，那么将这个 permission 添加到 package 的 grantedPermissions 列表中，表示这个 permission 申请成功（ granted ）。申请成功的同时会将这个申请到的 permission 的 gids 添加到这个 package 的 gids 中去</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hillli007.github.io/2018/10/15/linux/lfs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Li Xiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LXL Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/15/linux/lfs/" class="post-title-link" itemprop="https://hillli007.github.io/page/5/index.html">lfs</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-15 00:03:45" itemprop="dateCreated datePublished" datetime="2018-10-15T00:03:45+08:00">2018-10-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 23:18:34" itemprop="dateModified" datetime="2019-08-22T23:18:34+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><h3 id="登录Shell和非登录Shell"><a href="#登录Shell和非登录Shell" class="headerlink" title="登录Shell和非登录Shell"></a>登录Shell和非登录Shell</h3><ul>
<li>非登录Shell用户是无法访问linux的，只能用于samba、ftp等。</li>
<li>进入ubuntu桌面即登录Shell，而在桌面打开的terminal是非登录Shell,因为是登录Shell子Shell所以可访问linux系统</li>
<li>“echo $0” 如果以 “-“ 开头即登录Shell</li>
<li>“su -“ 和  “su” 代表切换用户时是登录还是非登录Shell</li>
</ul>
<p>登录Shell(不管是不是交互式的)文件加载顺序如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/profile</span><br><span class="line">~/.bash_profile</span><br><span class="line">~/.bash_login</span><br><span class="line">~/.profile</span><br></pre></td></tr></table></figure>
<p>交互式非登录Shell文件加载顺序如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/bashrc</span><br><span class="line">~/.bashrc</span><br></pre></td></tr></table></figure>
<h3 id="fork、source-和-exec"><a href="#fork、source-和-exec" class="headerlink" title="fork、source 和 exec"></a>fork、source 和 exec</h3><ul>
<li>fork: 创建子进程执行，一般直接运行脚本就会fork进程</li>
<li>source: 不创建进程，在当前进程执行</li>
<li>exec: 原进程执行，并且终止原进程</li>
</ul>
<p>举个例子:</p>
<blockquote>
<p>在shell脚本里的cd命令执行完之后并没有生效，用source方式则可<br>就是fork一个新进程和在当前进程执行的区别</p>
</blockquote>
<h3 id="chroot"><a href="#chroot" class="headerlink" title="chroot"></a>chroot</h3><p>chroot命令用来在指定的根目录下运行指令</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><h3 id="准备工具"><a href="#准备工具" class="headerlink" title="准备工具"></a>准备工具</h3><ul>
<li>下载BOOK和源码</li>
<li>检查宿主系统工具与库是否符合要求</li>
</ul>
<h3 id="设置环境"><a href="#设置环境" class="headerlink" title="设置环境"></a>设置环境</h3><p>源码和工具链目录要先chown给lfs用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chown -v lfs $LFS/tools</span><br><span class="line">chown -vR lfs $LFS/sources</span><br></pre></td></tr></table></figure>
<p>su - lfs 时其实是非登录Shell，因为.bash_profile直接执行的bash，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env -i NAME1=VALUE1 NAME2=VALUE2 &lt;command-line&gt;</span><br></pre></td></tr></table></figure>
<p>使用指定的环境变量执行命令行<command-line></command-line></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; ~/.bash_profile &lt;&lt; &quot;EOF&quot;</span><br><span class="line">exec env -i HOME=$HOME TERM=$TERM PS1=&apos;\u:\w\$ &apos; /bin/bash</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<h3 id="创建工具链"><a href="#创建工具链" class="headerlink" title="创建工具链"></a>创建工具链</h3><ul>
<li>用宿主系统的编译工具创建临时工具链”$LFS/tools -&gt; /tools”，目的是为了用来编译LFS，为了保持LFS不被宿主系统污染。</li>
<li>工具链有基本的binutils、glic、gcc、linux api header等，但是会加上前缀用于与宿主系统工具区分开来。</li>
<li>工具链里的工具不是LFS真正使用的，后续编译系统时需要再次编译binutils、glic、gcc、linux api header等。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hillli007.github.io/2018/10/15/linux/disk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Li Xiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LXL Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/15/linux/disk/" class="post-title-link" itemprop="https://hillli007.github.io/page/5/index.html">硬盘和分区，以及</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-15 00:03:17" itemprop="dateCreated datePublished" datetime="2018-10-15T00:03:17+08:00">2018-10-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 23:18:34" itemprop="dateModified" datetime="2019-08-22T23:18:34+08:00">2019-08-22</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h2><ul>
<li>磁盘是由一系列盘片组成的圆柱体，每个盘片都有上下面两个对应的磁头</li>
<li>每个盘面上的同心圆就是一个磁道(Track)，一个磁道上等分的一小段弧形就是磁盘基本单位Sector</li>
<li>从外到内，从上到下</li>
</ul>
<ul>
<li>Cylinder: 柱面所有半径相同的磁道的组合，是圆柱体的一个侧面</li>
<li>Heads: 磁头数，等于盘片数的两倍</li>
<li>Track:</li>
<li>Sector: 扇区，基本单位，一般为512b</li>
<li>Block： </li>
</ul>
<h2 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h2><h3 id="分区类型"><a href="#分区类型" class="headerlink" title="分区类型"></a>分区类型</h3><ul>
<li>主分区:</li>
<li>逻辑分区:</li>
<li>扩展分区:</li>
</ul>
<p><strong>主分区和扩展分区以及逻辑分区</strong></p>
<p>一个磁道最多可分4个主分区，而不是主分区的剩余容量就是扩展分区，扩展分区本身不能用，扩展分区可以分为多个逻辑分区</p>
<h3 id="MBR分区表"><a href="#MBR分区表" class="headerlink" title="MBR分区表"></a>MBR分区表</h3><ul>
<li>第一个扇区为分区表</li>
<li>扇区(512b): 446b启动程序 + 64b分区表 + 2b结束标志</li>
<li>64b分区表可划分四个主分区，每个分区用16b表示</li>
</ul>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>##</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hillli007.github.io/2018/10/15/linux/fileserver/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Li Xiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LXL Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/15/linux/fileserver/" class="post-title-link" itemprop="https://hillli007.github.io/page/5/index.html">文件服务</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-15 00:02:39" itemprop="dateCreated datePublished" datetime="2018-10-15T00:02:39+08:00">2018-10-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 23:18:34" itemprop="dateModified" datetime="2019-08-22T23:18:34+08:00">2019-08-22</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Samba"><a href="#Samba" class="headerlink" title="Samba"></a>Samba</h3><p>需安装: samba samba-common</p>
<h2 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h2><p>samba用户必须是Linux用户，通过<code>smbpasswd -a user</code>添加samba用户, user必须是<strong>linux用户</strong></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>设置 write list = user 即有读写权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ubuntu]</span><br><span class="line">path = /path/to/dir</span><br><span class="line">writable = yes</span><br></pre></td></tr></table></figure>
<h3 id="FTP"><a href="#FTP" class="headerlink" title="FTP"></a>FTP</h3><p>Ubuntu下安装vsftpd</p>
<p>访问FTP服务器时需要经过验证,只有经过了FTP服务器的相关验证,用户才能访问和传输文件.vsftpd提供了3种ftp登录形式:</p>
<ul>
<li>anonymous(匿名帐号),用户可以以anonymous为用户名,以自己的电子邮件地址为密码进行登录.当匿名用户登录FTP服务器后,其登录目录为匿名FTP服务器的根目录/var/ftp</li>
<li>real(真实帐号),就是以真实的用户名和密码进行登录,但前提条件是用户在FTP服务器上拥有自己的帐号.用真实帐号登录后,其登录的目录为用户自己的目录,该目录在系统建立帐号时系统就自动创建.</li>
<li>guest(虚拟帐号),如果用户在FTP服务器上拥有帐号,但此帐号只能用于文件传输服务,那么该帐号就是guest,guest是真实帐号的一种形式,它们的不同之处在于,geust登录FTP服务器后,不能访问除宿主目录以外的内容</li>
</ul>
<p>FTP和Samba的不同主要是管理单元分别是用户和文件夹</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://hillli007.github.io/2018/10/15/util/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Li Xiaolong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LXL Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/15/util/git/" class="post-title-link" itemprop="https://hillli007.github.io/page/5/index.html">git & gerrit</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-15 00:02:11" itemprop="dateCreated datePublished" datetime="2018-10-15T00:02:11+08:00">2018-10-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-08-22 23:18:34" itemprop="dateModified" datetime="2019-08-22T23:18:34+08:00">2019-08-22</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="分支和标签"><a href="#分支和标签" class="headerlink" title="分支和标签"></a>分支和标签</h2><h2 id="子模块"><a href="#子模块" class="headerlink" title="子模块"></a>子模块</h2><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><p>添加子模块，会自动clone:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add &lt;url&gt; [path]</span><br></pre></td></tr></table></figure>
<p>可以递归克隆仓库，子模块也会被克隆下来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone project.git projectDir --recursive</span><br></pre></td></tr></table></figure>
<h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><h3 id="内部原理"><a href="#内部原理" class="headerlink" title="内部原理"></a>内部原理</h3><p>在 .git/config下会添加submodule项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[submodule &quot;third-party/GCanvas&quot;]</span><br><span class="line">        url = https://github.com/alibaba/GCanvas.git</span><br><span class="line">        active = true</span><br></pre></td></tr></table></figure>
<p>在 .git/modules 下存放子模块的 .git 文件夹，子模块目录下只有.git文件，内容是.git文件夹路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitdir: ../../.git/modules/third-party/GCanvas</span><br></pre></td></tr></table></figure>
<p>远程仓库都是靠 .gitsubmodule 文件来记录子模块的，具体本地的.git文件夹的东西不影响</p>
<p>.git文件夹应该是 git submodule命令检测依据，<br>手动编辑 .gitsubmodule文件，init和update都无效，只能从新Add</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Li Xiaolong</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Li Xiaolong</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.3.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v6.6.0</div>




        








        
      </div>
    </footer>

    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script src="/js/src/utils.js?v=6.6.0"></script>

  <script src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.6.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  











  





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>
