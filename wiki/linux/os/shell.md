---
title: shell
date: 2018-10-14
tags: linux
categories:
---


### 登录Shell和非登录Shell

- 非登录Shell用户是无法访问linux的，只能用于samba、ftp等。
- 进入ubuntu桌面即登录Shell，而在桌面打开的terminal是非登录Shell,因为是登录Shell子Shell所以可访问linux系统

- "echo $0" 如果以 "-" 开头即登录Shell
- "su -" 和  "su" 代表切换用户时是登录还是非登录Shell

登录Shell(不管是不是交互式的)文件加载顺序如下:

~~~
/etc/profile
~/.bash_profile
~/.bash_login
~/.profile
~~~

交互式非登录Shell文件加载顺序如下：

~~~
/etc/bashrc
~/.bashrc
~~~

### fork、source 和 exec

- fork: 创建子进程执行，一般直接运行脚本就会fork进程
- source: 不创建进程，在当前进程执行
- exec: 原进程执行，并且终止原进程

举个例子:

> 在shell脚本里的cd命令执行完之后并没有生效，用source方式则可
> 就是fork一个新进程和在当前进程执行的区别

### 参数

以下参数脚本和函数一致

| 表达式 | 说明                                             |
|-----|------------------------------------------------|
| $0  | 脚本的文件名                                         |
| $n  | 第n个参数                                          |
| $#  | 参数个数                                           |
| $*  | 所有参数                                           |
| $@  | 所有参数。双引号包含时，"$*"的参数被当做一个整体，而"$@"还是遍历每一个参数      |
| $?  | 上个命令的退出状态，或函数的返回值。一般情况下，大部分命令执行成功会返回 0，失败返回 1。 |
| $$  | 当前Shell进程ID。                                   |

### 换行

语句结束时需要换行或者分号，但是换行不一定代表语句结束，同一行的分句已分号结束

~~~
if [ 2 -eq 1 ]; then
    echo 1;
elif [ 1 -eq 2 ]; then
    echo 2;
else
    echo 3;
 fi;
~~~

~~~
for c in "a b c"; do echo $c; done;
~~~

### 条件判断

[ 1 -eq 1 ] 与中括号的空格不能省略

#### 字符串判断

| 表达式          | 说明               |
|--------------|------------------|
| str1 = str2  | 当两个串有相同内容、长度时为真  |
| str1 = str2  | 当两个串有相同内容、长度时为真  |
| str1 != str2 | 当串str1和str2不等时为真 |
| -n str1      | 当串的长度大于0时为真(串非空) |
| -z str       | 当串的长度为0时为真(空串)   |
| str1         | 当串str1为非空时为真     |

#### 数字的判断

| 表达式     | 说明       |
|---------|----------|
| a -eq b | 两数相等为真   |
| a -ne b | 两数不等为真   |
| a -gt b | a大于b为真   |
| a -ge b | a大于等于b为真 |
| a -lt b | a小于b为真   |
| a -le b | a小于等于b为真 |

#### 文件的判断

| 表达式  | 说明                      |
|---------|-------------------------|
| -r file | 用户可读为真                  |
| -w file | 用户可写为真                  |
| -x file | 用户可执行为真                 |
| -f file | 文件为正规文件为真               |
| -d file | 文件为目录为真                 |
| -c file | 文件为字符特殊文件为真             |
| -b file | 文件为块特殊文件为真              |
| -s file | 文件大小非0时为真               |
| -t file | 当文件描述符(默认为1)指定的设备为终端时为真 |

#### 复杂逻辑判断

* 与: -a
* 或: -o
* 非: !

